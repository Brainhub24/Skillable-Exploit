<?php
/*
 __ _    _ _ _       _     _          __            _       _ _   
/ _\ | _(_) | | __ _| |__ | | ___    /__\_  ___ __ | | ___ (_) |_ 
\ \| |/ / | | |/ _` | '_ \| |/ _ \  /_\ \ \/ / '_ \| |/ _ \| | __|
_\ \   <| | | | (_| | |_) | |  __/ //__  >  <| |_) | | (_) | | |_ 
\__/_|\_\_|_|_|\__,_|_.__/|_|\___| \__/ /_/\_\ .__/|_|\___/|_|\__|
                                             |_|                  
	Test exploit for the Skillable Lab for solving all steps using a webhook.
	Developer: Jan Gebser (An independent Software Analyst)
	@Github  : Brainhub24 (www.brainhub24.com)
	Contact  : 0x23@gfn.skillable.exploit.lab.heimdall-security.net

	WEB-LAB  : gfn.skillable.exploit.lab.heimdall-security.net

*/

// Get the data sent from JavaScript code
$data = json_decode(file_get_contents('php://input'), true);

// Extract the necessary data
$numCheckboxes = $data['numCheckboxes'];
$contentProcessed = $data['contentProcessed'];
$dateTime = date('Y-m-d H:i:s');
$url = $data['url'];
$screenshot = base64_decode($data['screenshot']);

// Save the screenshot to a file
$screenshotFilename = 'screenshot_' . date('Ymd_His') . '.png';
file_put_contents($screenshotFilename, $screenshot);

// Build the message to be logged
$message = "[$dateTime] Checked $numCheckboxes checkboxes for $url.\nContent processed: $contentProcessed\nScreenshot saved to: $screenshotFilename\n";

// Log the message to a file
$logFilename = 'webhook.log';
file_put_contents($logFilename, $message, FILE_APPEND | LOCK_EX);

// Send a response to the JavaScript code
$response = [
    'success' => true,
    'message' => 'Data received and logged successfully.'
];
echo json_encode($response);
